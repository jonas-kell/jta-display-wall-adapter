use std::{error::Error, time::SystemTime};

#[derive(Debug)]
pub enum ParsedCommunication {
    Unknown,
}

const NUMBER_OF_HEADER_BYTES: usize = 17;
// https://winprotocoldocs-bhdugrdyduf5h2e4.b02.azurefd.net/MS-NRBF/%5bMS-NRBF%5d.pdf -> page 37
// 1 Byte RecordTypeEnum -> value must be 0
// 4 Bytes RootId
// 4 Bytes HeaderId
// 4 Bytes MajorVersion -> value must be 1
// 4 Bytes MinorVersion -> value must be 0

/// Decode the message custom action
pub fn decode_single_nrbf(packet: &[u8]) -> Result<ParsedCommunication, Box<dyn Error>> {
    let header_bytes = &packet[0..NUMBER_OF_HEADER_BYTES];
    let rest_bytes = &packet[NUMBER_OF_HEADER_BYTES..];

    let record_type = header_bytes[0];
    let root_id = i32_from_bytes(&header_bytes[1..5]);
    let header_id = i32_from_bytes(&header_bytes[5..9]);
    let major_version = i32_from_bytes(&header_bytes[9..13]);
    let minor_version = i32_from_bytes(&header_bytes[13..17]);

    if record_type != 0x00 {
        return Err("RecordTypeEnum in Header must be 0".into());
    }
    if major_version != 1 {
        return Err("Major Version not 1".into());
    }
    if minor_version != 0 {
        return Err("Minor Version not 0".into());
    }

    hex_log_bytes(header_bytes);
    trace!("Header: root_id:{} header_id:{}", root_id, header_id);

    log_bytes(rest_bytes);

    Ok(ParsedCommunication::Unknown)
}

fn i32_from_bytes(bytes: &[u8]) -> i32 {
    return i32::from_le_bytes(bytes.try_into().unwrap_or([0x00, 0x00, 0x00, 0x00]));
}

fn hex_log_bytes(buf: &[u8]) {
    let hex_repr = buf
        .iter()
        .map(|b| format!("{:02X}", b))
        .collect::<Vec<_>>()
        .join(" ");

    trace!(
        "({} bytes) Hex: \n{}",
        buf.len(),
        hex_repr.chars().collect::<String>(),
    );
}

fn log_bytes(buf: &[u8]) {
    let decoded: String = String::from_utf8_lossy(buf).to_string();

    let hex_repr = buf
        .iter()
        .map(|b| format!("{:02X}", b))
        .collect::<Vec<_>>()
        .join(" ");

    trace!(
        "({} bytes)\nText: \n{}\nHex: \n{}",
        buf.len(),
        decoded.chars().collect::<String>(),
        hex_repr.chars().collect::<String>(),
    );
}

const HEADER_BYTES_TEMPLATE: [u8; 17] = [
    0x00, 0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00,
];

pub fn pre_response() -> Vec<u8> {
    let content: [u8; 1596] = [
        0x0C, 0x02, 0x00, 0x00, 0x00, 0x53, 0x44, 0x69, 0x73, 0x70, 0x6C, 0x61, 0x79, 0x42, 0x6F,
        0x61, 0x72, 0x64, 0x2E, 0x43, 0x6F, 0x6D, 0x6D, 0x75, 0x6E, 0x69, 0x63, 0x61, 0x74, 0x69,
        0x6F, 0x6E, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x31, 0x2E, 0x30,
        0x2E, 0x30, 0x2E, 0x31, 0x32, 0x38, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65,
        0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69,
        0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x6E, 0x75, 0x6C, 0x6C, 0x05,
        0x01, 0x00, 0x00, 0x00, 0x2D, 0x44, 0x69, 0x73, 0x70, 0x6C, 0x61, 0x79, 0x42, 0x6F, 0x61,
        0x72, 0x64, 0x2E, 0x43, 0x6F, 0x6D, 0x6D, 0x75, 0x6E, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6F,
        0x6E, 0x2E, 0x50, 0x61, 0x63, 0x6B, 0x65, 0x74, 0x73, 0x2E, 0x53, 0x65, 0x72, 0x76, 0x65,
        0x72, 0x49, 0x6E, 0x66, 0x6F, 0x02, 0x00, 0x00, 0x00, 0x23, 0x3C, 0x41, 0x70, 0x6C, 0x6C,
        0x69, 0x63, 0x61, 0x74, 0x69, 0x6F, 0x6E, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3E,
        0x6B, 0x5F, 0x5F, 0x42, 0x61, 0x63, 0x6B, 0x69, 0x6E, 0x67, 0x46, 0x69, 0x65, 0x6C, 0x64,
        0x19, 0x3C, 0x43, 0x68, 0x61, 0x6E, 0x6E, 0x65, 0x6C, 0x73, 0x3E, 0x6B, 0x5F, 0x5F, 0x42,
        0x61, 0x63, 0x6B, 0x69, 0x6E, 0x67, 0x46, 0x69, 0x65, 0x6C, 0x64, 0x01, 0x03, 0xBA, 0x02,
        0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x43, 0x6F, 0x6C, 0x6C, 0x65, 0x63, 0x74, 0x69,
        0x6F, 0x6E, 0x73, 0x2E, 0x47, 0x65, 0x6E, 0x65, 0x72, 0x69, 0x63, 0x2E, 0x4C, 0x69, 0x73,
        0x74, 0x60, 0x31, 0x5B, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x54, 0x75, 0x70,
        0x6C, 0x65, 0x60, 0x32, 0x5B, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x49, 0x6E,
        0x74, 0x33, 0x32, 0x2C, 0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20,
        0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30,
        0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72,
        0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F,
        0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33,
        0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x2C, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E,
        0x53, 0x74, 0x72, 0x69, 0x6E, 0x67, 0x2C, 0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69,
        0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E,
        0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65,
        0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65,
        0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36,
        0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x5D, 0x2C, 0x20, 0x6D, 0x73, 0x63,
        0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D,
        0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72,
        0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C,
        0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61,
        0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x5D, 0x02,
        0x00, 0x00, 0x00, 0x06, 0x03, 0x00, 0x00, 0x00, 0x09, 0x31, 0x2E, 0x30, 0x2E, 0x30, 0x2E,
        0x31, 0x32, 0x38, 0x09, 0x04, 0x00, 0x00, 0x00, 0x04, 0x04, 0x00, 0x00, 0x00, 0xBA, 0x02,
        0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x43, 0x6F, 0x6C, 0x6C, 0x65, 0x63, 0x74, 0x69,
        0x6F, 0x6E, 0x73, 0x2E, 0x47, 0x65, 0x6E, 0x65, 0x72, 0x69, 0x63, 0x2E, 0x4C, 0x69, 0x73,
        0x74, 0x60, 0x31, 0x5B, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x54, 0x75, 0x70,
        0x6C, 0x65, 0x60, 0x32, 0x5B, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x49, 0x6E,
        0x74, 0x33, 0x32, 0x2C, 0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20,
        0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30,
        0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72,
        0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F,
        0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33,
        0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x2C, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E,
        0x53, 0x74, 0x72, 0x69, 0x6E, 0x67, 0x2C, 0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69,
        0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E,
        0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65,
        0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65,
        0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36,
        0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x5D, 0x2C, 0x20, 0x6D, 0x73, 0x63,
        0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D,
        0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72,
        0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C,
        0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61,
        0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x5D, 0x03,
        0x00, 0x00, 0x00, 0x06, 0x5F, 0x69, 0x74, 0x65, 0x6D, 0x73, 0x05, 0x5F, 0x73, 0x69, 0x7A,
        0x65, 0x08, 0x5F, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x03, 0x00, 0x00, 0xCA, 0x01,
        0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x54, 0x75, 0x70, 0x6C, 0x65, 0x60, 0x32, 0x5B,
        0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x49, 0x6E, 0x74, 0x33, 0x32, 0x2C, 0x20,
        0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69,
        0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C,
        0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50,
        0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62,
        0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39,
        0x5D, 0x2C, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x53, 0x74, 0x72, 0x69, 0x6E,
        0x67, 0x2C, 0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65,
        0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20,
        0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C,
        0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65,
        0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65,
        0x30, 0x38, 0x39, 0x5D, 0x5D, 0x5B, 0x5D, 0x08, 0x08, 0x09, 0x05, 0x00, 0x00, 0x00, 0x01,
        0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x07, 0x05, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
        0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x03, 0xC8, 0x01, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D,
        0x2E, 0x54, 0x75, 0x70, 0x6C, 0x65, 0x60, 0x32, 0x5B, 0x5B, 0x53, 0x79, 0x73, 0x74, 0x65,
        0x6D, 0x2E, 0x49, 0x6E, 0x74, 0x33, 0x32, 0x2C, 0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C,
        0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30,
        0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E,
        0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B,
        0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35,
        0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x2C, 0x5B, 0x53, 0x79, 0x73,
        0x74, 0x65, 0x6D, 0x2E, 0x53, 0x74, 0x72, 0x69, 0x6E, 0x67, 0x2C, 0x20, 0x6D, 0x73, 0x63,
        0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D,
        0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72,
        0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C,
        0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37, 0x61,
        0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x5D, 0x09,
        0x06, 0x00, 0x00, 0x00, 0x0D, 0x03, 0x04, 0x06, 0x00, 0x00, 0x00, 0xC8, 0x01, 0x53, 0x79,
        0x73, 0x74, 0x65, 0x6D, 0x2E, 0x54, 0x75, 0x70, 0x6C, 0x65, 0x60, 0x32, 0x5B, 0x5B, 0x53,
        0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x49, 0x6E, 0x74, 0x33, 0x32, 0x2C, 0x20, 0x6D, 0x73,
        0x63, 0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E,
        0x3D, 0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75,
        0x72, 0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62,
        0x6C, 0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x62, 0x37, 0x37,
        0x61, 0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38, 0x39, 0x5D, 0x2C,
        0x5B, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x2E, 0x53, 0x74, 0x72, 0x69, 0x6E, 0x67, 0x2C,
        0x20, 0x6D, 0x73, 0x63, 0x6F, 0x72, 0x6C, 0x69, 0x62, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73,
        0x69, 0x6F, 0x6E, 0x3D, 0x34, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x30, 0x2C, 0x20, 0x43, 0x75,
        0x6C, 0x74, 0x75, 0x72, 0x65, 0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20,
        0x50, 0x75, 0x62, 0x6C, 0x69, 0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D,
        0x62, 0x37, 0x37, 0x61, 0x35, 0x63, 0x35, 0x36, 0x31, 0x39, 0x33, 0x34, 0x65, 0x30, 0x38,
        0x39, 0x5D, 0x5D, 0x02, 0x00, 0x00, 0x00, 0x07, 0x6D, 0x5F, 0x49, 0x74, 0x65, 0x6D, 0x31,
        0x07, 0x6D, 0x5F, 0x49, 0x74, 0x65, 0x6D, 0x32, 0x00, 0x01, 0x08, 0x00, 0x00, 0x00, 0x00,
        0x06, 0x07, 0x00, 0x00, 0x00, 0x06, 0x4F, 0x75, 0x74, 0x70, 0x75, 0x74, 0x0B, 0x01, 0x01,
        0x02, 0x02, 0x03, 0x03, 0x00, 0x00,
    ];

    let combined: Vec<u8> = [HEADER_BYTES_TEMPLATE.as_slice(), content.as_slice()].concat();

    combined
}

pub fn image_response() -> Vec<u8> {
    let start: [u8; 250] = [
        0x0C, 0x02, 0x00, 0x00, 0x00, 0x53, 0x44, 0x69, 0x73, 0x70, 0x6C, 0x61, 0x79, 0x42, 0x6F,
        0x61, 0x72, 0x64, 0x2E, 0x43, 0x6F, 0x6D, 0x6D, 0x75, 0x6E, 0x69, 0x63, 0x61, 0x74, 0x69,
        0x6F, 0x6E, 0x2C, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6F, 0x6E, 0x3D, 0x31, 0x2E, 0x30,
        0x2E, 0x30, 0x2E, 0x31, 0x32, 0x38, 0x2C, 0x20, 0x43, 0x75, 0x6C, 0x74, 0x75, 0x72, 0x65,
        0x3D, 0x6E, 0x65, 0x75, 0x74, 0x72, 0x61, 0x6C, 0x2C, 0x20, 0x50, 0x75, 0x62, 0x6C, 0x69,
        0x63, 0x4B, 0x65, 0x79, 0x54, 0x6F, 0x6B, 0x65, 0x6E, 0x3D, 0x6E, 0x75, 0x6C, 0x6C, 0x05,
        0x01, 0x00, 0x00, 0x00, 0x2E, 0x44, 0x69, 0x73, 0x70, 0x6C, 0x61, 0x79, 0x42, 0x6F, 0x61,
        0x72, 0x64, 0x2E, 0x43, 0x6F, 0x6D, 0x6D, 0x75, 0x6E, 0x69, 0x63, 0x61, 0x74, 0x69, 0x6F,
        0x6E, 0x2E, 0x50, 0x61, 0x63, 0x6B, 0x65, 0x74, 0x73, 0x2E, 0x43, 0x75, 0x72, 0x72, 0x65,
        0x6E, 0x74, 0x56, 0x69, 0x65, 0x77, 0x03, 0x00, 0x00, 0x00, 0x21, 0x3C, 0x49, 0x6D, 0x61,
        0x67, 0x65, 0x73, 0x53, 0x65, 0x72, 0x69, 0x61, 0x6C, 0x69, 0x7A, 0x65, 0x64, 0x3E, 0x6B,
        0x5F, 0x5F, 0x42, 0x61, 0x63, 0x6B, 0x69, 0x6E, 0x67, 0x46, 0x69, 0x65, 0x6C, 0x64, 0x18,
        0x3C, 0x43, 0x68, 0x61, 0x6E, 0x6E, 0x65, 0x6C, 0x3E, 0x6B, 0x5F, 0x5F, 0x42, 0x61, 0x63,
        0x6B, 0x69, 0x6E, 0x67, 0x46, 0x69, 0x65, 0x6C, 0x64, 0x1A, 0x3C, 0x54, 0x69, 0x6D, 0x65,
        0x53, 0x74, 0x61, 0x6D, 0x70, 0x3E, 0x6B, 0x5F, 0x5F, 0x42, 0x61, 0x63, 0x6B, 0x69, 0x6E,
        0x67, 0x46, 0x69, 0x65, 0x6C, 0x64, 0x07, 0x00, 0x00, 0x02, 0x08, 0x0D, 0x02, 0x00, 0x00,
        0x00, 0x09, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    ];

    // I assume date param. Must increment to update?
    // let modifying: [u8; 8] = [0x93, 0x82, 0xF6, 0x25, 0x38, 0x1B, 0xDE, 0x88];

    // Does not totally fit. But is smoething along this line:
    // https://winprotocoldocs-bhdugrdyduf5h2e4.b02.azurefd.net/MS-DTYP/%5bMS-DTYP%5d.pdf
    //     The FILETIME structure is a 64-bit value that represents the number of 100-nanosecond intervals that
    // have elapsed since January 1, 1601, Coordinated Universal Time (UTC).
    // typedef struct _FILETIME {
    //  DWORD dwLowDateTime;
    //  DWORD dwHighDateTime;
    // } FILETIME,
    // *PFILETIME,
    // *LPFILETIME;

    let duration_since_epoch = SystemTime::now()
        .duration_since(SystemTime::UNIX_EPOCH)
        .expect("Time went backwards");
    let count_100ns = (duration_since_epoch.as_nanos() / 100) as u64;
    // Convert to little-endian byte array ([u8; 8])
    let modifying: [u8; 8] = count_100ns.to_le_bytes();

    let data: [u8; 113] = [
        0x0F, 0x03, 0x00, 0x00, 0x00, 0x5E, 0x00, 0x00, 0x00, 0x02, 0x42, 0x4D, 0x5E, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x01, 0x00,
        0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x01, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x74, 0x12, 0x00, 0x00, 0x74, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00,
        0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00,
        0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0x0B,
        0x01, 0x01, 0x02, 0x02, 0x03, 0x03, 0x00, 0x00,
    ];

    let combined: Vec<u8> = [
        HEADER_BYTES_TEMPLATE.as_slice(),
        start.as_slice(),
        modifying.as_slice(),
        data.as_slice(),
    ]
    .concat();

    combined
}
